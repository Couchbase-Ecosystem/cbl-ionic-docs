"use strict";(self.webpackChunkcbl_ionic=self.webpackChunkcbl_ionic||[]).push([[1737],{2898:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>l});var t=n(4848),r=n(8453);const s={id:"live-queries",sidebar_position:6},a="Live Queries",o={id:"Queries/live-queries",title:"Live Queries",description:"Description - Couchbase Lite Live Query Concepts",source:"@site/docs/Queries/live-queries.md",sourceDirName:"Queries",slug:"/Queries/live-queries",permalink:"/Queries/live-queries",draft:!1,unlisted:!1,editUrl:"https://github.com/Couchbase-Ecosystem/cbl-ionic-docs/docs/Queries/live-queries.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{id:"live-queries",sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"Query Result Sets",permalink:"/Queries/query-result-set"},next:{title:"Query Troubleshoooting",permalink:"/Queries/query-troubleshooting"}},c={},l=[{value:"Activating a Live Query",id:"activating-a-live-query",level:2},{value:"Example 1. Starting a Live Query - Change Listener",id:"example-1-starting-a-live-query---change-listener",level:4},{value:"Example 2. Stopping a Live Query - Change Listener",id:"example-2-stopping-a-live-query---change-listener",level:4}];function u(e){const i={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.h1,{id:"live-queries",children:"Live Queries"}),"\n",(0,t.jsxs)(i.blockquote,{children:["\n",(0,t.jsxs)(i.p,{children:["Description - ",(0,t.jsx)(i.em,{children:"Couchbase Lite Live Query Concepts"}),"\nRelated Content - ",(0,t.jsx)(i.a,{href:"/Queries/sqlplusplus",children:"SQL++ for Mobile"})]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"activating-a-live-query",children:"Activating a Live Query"}),"\n",(0,t.jsx)(i.p,{children:"A live query is a query that, once activated, remains active and monitors the database for changes; refreshing the result set whenever a change occurs. As such, it is a great way to build reactive user interfaces\u2009\u2014\u2009especially table/list views\u2009\u2014\u2009that keep themselves up to date."}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"So, a simple use case may be:"})," A replicator running and pulling new data from a server, whilst a live-query-driven UI automatically updates to show the data without the user having to manually refresh. This helps your app feel quick and responsive."]}),"\n",(0,t.jsx)(i.p,{children:"With Couchbase Lite for Ionic, live queries can be watched through:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Listener callbacks: ",(0,t.jsx)(i.code,{children:"Query.addChangeListener"})]}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:"Each time you start watching a live query, the query is executed and an initial change notification is dispatched. The query is then kept active and further change notifications are dispatched whenever a change occurs."}),"\n",(0,t.jsx)(i.h4,{id:"example-1-starting-a-live-query---change-listener",children:"Example 1. Starting a Live Query - Change Listener"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-typescript",children:"// Register a change listener and await the Promise returned from the registration call.\nconst token = await query.addChangeListener((change) => {  \n  if (change.error !== null && change.error !== undefined) {  \n    // deal with error...  \n  } else {  \n    const results = change.results;  \n    //loop through ResultSet  \n    for (const doc of results) {  \n      //do something with doc                   \n    }  \n  }  \n}); \n"})}),"\n",(0,t.jsx)(i.admonition,{type:"note",children:(0,t.jsx)(i.p,{children:"Queries that use parameter expressions (e.g. $param) are not compatible with live queries and cannot be observed for changes."})}),"\n",(0,t.jsxs)(i.p,{children:["To stop receiving notifications, call ",(0,t.jsx)(i.code,{children:"Query.removeChangeListener"})," with the token that was returned from the registration call. Regardless of the whether the API is synchronous or asynchronous, listeners will stop receiving notifications immediately:"]}),"\n",(0,t.jsx)(i.h4,{id:"example-2-stopping-a-live-query---change-listener",children:"Example 2. Stopping a Live Query - Change Listener"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-typescript",children:"const token = await query.addChangeListener((change) => { ... });\nawait query.removeChangeListener(token);\n"})})]})}function h(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}},8453:(e,i,n)=>{n.d(i,{R:()=>a,x:()=>o});var t=n(6540);const r={},s=t.createContext(r);function a(e){const i=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function o(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(s.Provider,{value:i},e.children)}}}]);