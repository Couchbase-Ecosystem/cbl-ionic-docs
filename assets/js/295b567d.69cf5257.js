"use strict";(self.webpackChunkcbl_ionic=self.webpackChunkcbl_ionic||[]).push([[3549],{6982:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>s,default:()=>h,frontMatter:()=>o,metadata:()=>c,toc:()=>l});var a=t(4848),i=t(8453);const o={id:"migration",sidebar_position:15},s="Migration",c={id:"migration",title:"Migration",description:"Description \u2014 Migrating from @ionic-enterprise/couchbase-lite package",source:"@site/docs/migration.md",sourceDirName:".",slug:"/migration",permalink:"/migration",draft:!1,unlisted:!1,editUrl:"https://github.com/Couchbase-Ecosystem/cbl-ionic-docs/docs/migration.md",tags:[],version:"current",sidebarPosition:15,frontMatter:{id:"migration",sidebar_position:15},sidebar:"tutorialSidebar",previous:{title:"API References",permalink:"/api-reference"},next:{title:"Troubleshooting",permalink:"/category/troubleshooting"}},r={},l=[{value:"Information",id:"information",level:2},{value:"Database Compact / Database Maintenance",id:"database-compact--database-maintenance",level:2},{value:"Scopes/Collections",id:"scopescollections",level:2},{value:"Save Example",id:"save-example",level:3},{value:"Retrieving a Document",id:"retrieving-a-document",level:3},{value:"Delete a document",id:"delete-a-document",level:3},{value:"Javascript Docs support",id:"javascript-docs-support",level:4},{value:"Query Builder API Replaced with SQL++",id:"query-builder-api-replaced-with-sql",level:2},{value:"Replication Configuration",id:"replication-configuration",level:2},{value:"New Features",id:"new-features",level:3},{value:"Conclusion",id:"conclusion",level:2}];function d(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h1,{id:"migration",children:"Migration"}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:["Description \u2014 Migrating from @ionic-enterprise/couchbase-lite package\nRelated Content \u2014 ",(0,a.jsx)(n.a,{href:"/databases",children:"Database"})," | ",(0,a.jsx)(n.a,{href:"/scopes-collections",children:"Scopes/Collections"})]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"information",children:"Information"}),"\n",(0,a.jsxs)(n.p,{children:["In the past, Ionic offered a plugin for Couchbase Lite, known as @ionic-enterprise/couchbase-lite. However, this plugin has since been deprecated by Ionic. The Couchbase Developer Experience and Ecosystem team took the original plugin as a foundation and transformed it into the cbl-ionic package. This migration documentation aims to address common challenges you may encounter when transitioning from the Ionic version of the plugin to the new open-source ",(0,a.jsx)(n.code,{children:"cbl-ionic"})," plugin."]}),"\n",(0,a.jsxs)(n.p,{children:["From an architectural standpoint, the ",(0,a.jsx)(n.code,{children:"cbl-ionic"})," plugin bears a strong resemblance to the original plugin. The key difference is that the ",(0,a.jsx)(n.code,{children:"cbl-ionic"})," package is open-source and maintained by the Couchbase Developer Experience and Ecosystem team. The iOS implementation, originally written in Objective-C, has been rewritten in Swift. Similarly, the original Android implementation, which was written in Java, has been replaced with Kotlin.  The primary objective of the ",(0,a.jsx)(n.code,{children:"cbl-ionic"})," plugin is to facilitate access to the latest versions of Couchbase Lite 3.x, while also supporting some of the major new features that the 3.x release offers:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Scopes and Collections"}),"\n",(0,a.jsx)(n.li,{children:"SQL++ Queries"}),"\n",(0,a.jsx)(n.li,{children:"Database Maintenance"}),"\n",(0,a.jsx)(n.li,{}),"\n"]}),"\n",(0,a.jsx)(n.admonition,{type:"note",children:(0,a.jsx)(n.p,{children:"By updating your app to use this plugin, your database will be instantly upgraded to a 3.x database, enabling support for Scopes and Collections. This behavior mirrors that of the native SDKs for each platform."})}),"\n",(0,a.jsx)(n.h2,{id:"database-compact--database-maintenance",children:"Database Compact / Database Maintenance"}),"\n",(0,a.jsx)(n.p,{children:"Originally the old plugin provided the ability to compact a database using the following API:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"const db = new Database('myDatabaseName');\nawait db.open();\nawait db.compact();\n"})}),"\n",(0,a.jsx)(n.p,{children:"This has been changed out with the Database Maintenance API.  Now you can call the performMaintenance function and pass it in one of the values from the MaintenanceType enum:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"const db = new Database('myDatabaseName');\nawait db.open();\nawait db.performMaintenance(MaintenanceType.COMPACT);\n"})}),"\n",(0,a.jsx)(n.p,{children:"The MaintenanceType enum includes:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"export enum MaintenanceType {\n  COMPACT = 0,\n  REINDEX = 1,\n  INTEGRITY_CHECK = 2,\n  OPTIMIZE = 3,\n  FULL_OPTIMIZE = 4,\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"These bring the Ionic package in line with the native SDK's for each platform."}),"\n",(0,a.jsx)(n.h2,{id:"scopescollections",children:"Scopes/Collections"}),"\n",(0,a.jsx)(n.p,{children:"With the introduction of Couchbase Mobile 3.1, the support for Scopes and Collections was added. This feature enhances performance by allowing documents to be stored in different collections based on their type, eliminating the need for indexes to locate documents of a specific type. While indexes can boost query performance, they can also hinder write performance. Therefore, Scopes and Collections offer a way to enhance query performance without relying on indexes."}),"\n",(0,a.jsx)(n.p,{children:'For teams that have not yet transitioned to using custom scopes and collections, the "_default" scope and "_default" collection can be utilized. The Database class provides methods to access both the default scope and collection:'}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"\nconst db = new Database('myDatabaseName');\nawait db.open();\n\nconst collection = await db.defaultCollection();\n"})}),"\n",(0,a.jsx)(n.p,{children:"Most operations for documents that were done on the Database API must be done using the Collection API.  Basic CRUD examples are shown below:"}),"\n",(0,a.jsx)(n.h3,{id:"save-example",children:"Save Example"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Before"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:'const doc = new MutableDocument(\'doc1\');\ndoc.setString("name", "test");\nawait db.save(doc);    \n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"After"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:'const doc = new MutableDocument(\'doc1\');\ndoc.setString("name", "test");\nawait collection.save(doc); \n'})}),"\n",(0,a.jsx)(n.h3,{id:"retrieving-a-document",children:"Retrieving a Document"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Before"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:'const doc = await db.getDocument("doc1")\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"After"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:'const doc = await collection.document("doc1"); \n'})}),"\n",(0,a.jsx)(n.h3,{id:"delete-a-document",children:"Delete a document"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Before"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:'const doc = await db.deleteDocument("doc1")\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"After"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:'const doc = await collection.deleteDocument("doc1"); \n'})}),"\n",(0,a.jsx)(n.p,{children:"Other APIs have also been moved from the Database class to the Collections class including:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Purge Document"}),"\n",(0,a.jsx)(n.li,{children:"Document Expiration"}),"\n",(0,a.jsx)(n.li,{children:"Document Change Listener"}),"\n",(0,a.jsx)(n.li,{children:"Create Index"}),"\n",(0,a.jsx)(n.li,{children:"Delete Index"}),"\n",(0,a.jsx)(n.li,{children:"Get Indexes"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"For these APIs use the navigation menu on the left to see the new APIs for Database, Collection, and Indexes."}),"\n",(0,a.jsx)(n.h4,{id:"javascript-docs-support",children:"Javascript Docs support"}),"\n",(0,a.jsx)(n.p,{children:"Each function that was deprecated in the Database class has documentation stating that the API has been deprecated and using IDE's like Visual Studio Code should provide you with a warning along with information which API you should use instead."}),"\n",(0,a.jsx)(n.p,{children:"It is highly recommended that you call the collection version of these functions as the database version of the functions will be removed in a future release."}),"\n",(0,a.jsx)(n.h2,{id:"query-builder-api-replaced-with-sql",children:"Query Builder API Replaced with SQL++"}),"\n",(0,a.jsx)(n.p,{children:"The Query Builder API was removed due to it calling internal - non-public APIs that caused various issues along with hard to manage code.  The Couchbase Mobile SDK team provided a more robust API with SQL++ and the cbl-ionic SDK uses it exclusively for querying the database."}),"\n",(0,a.jsx)(n.p,{children:"SQL++ provides a much simpler approach to querying documents:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Before"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"const query = QueryBuilder.select(\n  SelectResult.expression(Meta.id),\n  SelectResult.property('name'),\n  SelectResult.property('type'),\n)\n  .from(DataSource.database(database))\n  .where(Expression.property('type').equalTo(Expression.string('hotel')))\n  .orderBy(Ordering.expression(Meta.id));\n\ntry {\n  const resultSet = await(await query.execute()).allResults();\n  for (let result of resultSet) {\n    console.log(\n      'Sample',\n      String.format('hotel id -> %s', result.getString('id')),\n    );\n    console.log(\n      'Sample',\n      String.format('hotel name -> %s', result.getString('name')),\n    );\n  }\n} catch (e) {\n  Log.e('Sample', e.getLocalizedMessage());\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"After"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"const queryString = \"SELECT META().id, name, type FROM _default._default WHERE type = 'hotel' ORDER BY META().id\";\ntry {\n    const query = await db.createQuery(queryString);\n    const results = await query.execute();\n    for (const result of results) {\n        console.log('Sample', `hotel id -> ${result.getString('id')}`);\n        console.log('Sample', `hotel name -> ${result.getString('name')}`);\n    }\n} catch (e) {\n    Log.e('Sample', e.getLocalizedMessage());\n} \n"})}),"\n",(0,a.jsx)(n.h2,{id:"replication-configuration",children:"Replication Configuration"}),"\n",(0,a.jsx)(n.p,{children:"With the release of Scopes and Collections comes the change to Replication.  In the past you would set the Replicator to point to a database that you wanted to replicate to.  Now you must set the Replicator to point to a collection or group of collections."}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Before"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"// Create replicators to push and pull changes to and from the cloud.\nconst targetEndpoint = new URLEndpoint(\n  new URI('ws://localhost:4984/projects'),\n);\nconst replConfig = new ReplicatorConfiguration(database, targetEndpoint);\nreplConfig.setReplicatorType(\n  ReplicatorConfiguration.ReplicatorType.PUSH_AND_PULL,\n);\n\n// Add authentication.\nreplConfig.setAuthenticator(new BasicAuthenticator('demo@example.com', 'P@ssw0rd12'));\n\n// Create replicator.\nlet replicator = new Replicator(replConfig);\n\n// Listen to replicator change events.\nreplicator.addChangeListener(status => {});\n\n// Start replication.\nreplicator.start();\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"After"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"//setup database and collection\nconst fileSystem = new FileSystem();\nconst directoryPath = await fileSystem.getDefaultPath();\n\nconst dc = new DatabaseConfiguration();\ndc.setDirectory(directoryPath);\nconst database = new Database('inventory', dc);\n\nawait database.open();\nconst collection = database.getDefaultCollection();\n\nconst target = new URLEndpoint('ws://localhost:4984/projects');\nconst auth = new BasicAuthenticator('demo@example.com', 'P@ssw0rd12');\nconst config = new ReplicatorConfiguration(target);\nconfig.addCollection(this.collection);\nconfig.setAuthenticator(auth);\n\nconst replicator = await Replicator.create(config);\n\n //listen to the replicator change events\nconst token = await replicator.addChangeListener((change) => {\n\t//check to see if there was an error\n   \tconst error = change.status.getError();\n  \tif (error !== undefined) {\n\t\t//do something with the error\n   \t}\n   \t//get the status of the replicator using ReplicatorActivityLevel enum\n  \tif (change.status.getActivityLevel() ===  ReplicatorActivityLevel.IDLE) {\n   \t\t//do something because the replicator is now IDLE\n   \t}\n });\n\n // start the replicator without making a new checkpoint\n await replicator.start(false);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"new-features",children:"New Features"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"cbl-ionic"})," plugin, in addition to supporting Scopes/Collections and SQL++ from the 3.x release, introduces several new features:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Database Change Encryption Key"}),": This new functionality in the Database API allows for the modification of a database's encryption key."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Document Expiration"}),": A new method in the Collection API enables the setting and retrieval of a document's expiration date."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Example App"}),": The ",(0,a.jsx)(n.code,{children:"cbl-ionic"})," repository includes a ",(0,a.jsx)(n.code,{children:"example"})," folder, which contains a comprehensive application for testing all APIs and features of the cbl-ionic plugin. It also includes a custom test runner for executing end-to-end tests written for the plugin"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Documentation"})," - Undeniably, one of the most challenging aspects of developing open source software is creating comprehensive documentation. This site addresses this by providing a complete set of documentation, allowing developers to explore the various APIs the plugin has to offers."]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,a.jsxs)(n.p,{children:["An application can be migrated over from the Ionic version of the Couchbase Lite plugin to the new ",(0,a.jsx)(n.code,{children:"cbl-ionic"})," package.  The new package provides a path to the latest version of Couchbase Lite 3.x and provides support for the new features that the 3.x release provides."]}),"\n",(0,a.jsxs)(n.p,{children:["The new ",(0,a.jsx)(n.code,{children:"cbl-ionic"})," plugin is open source and maintained by the Couchbase Developer Experience and Ecosystem team.  The new plugin is architecturally similar to the original plugin, but there are some differences in the API that will need to be addressed when migrating an application over to the new package.  The new plugin provides support for Scopes and Collections, SQL++ Queries, and Database Maintenance.  The new package also provides a more robust API for querying the database and for setting up replication.  The new package is recommended for all new applications that are using Couchbase Lite and for applications that are looking to migrate over from the Ionic version of the Couchbase Lite plugin."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>c});var a=t(6540);const i={},o=a.createContext(i);function s(e){const n=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),a.createElement(o.Provider,{value:n},e.children)}}}]);